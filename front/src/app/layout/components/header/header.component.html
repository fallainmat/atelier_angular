<div class="flex flex-col">
  <div class="flex justify-between">
    @if (currentUser(); as currentUser) {
      <div class="flex items-end">
        <p class="text-6xl font-bold text-gray-50">R</p>
        <p class="font-bold text-gray-50">obot</p>
        <p class="text-6xl font-bold text-gray-50">B</p>
        <p class="font-bold text-gray-50">et</p>
      </div>
      <div class="flex mt-2">
        <p class="font-bold text-2xl text-gray-50 mr-5">{{ currentUser.firstname + ' ' + currentUser.lastname }}</p>
        <p class="font-bold text-2xl text-gray-50">Coins: {{ currentUser.money }}</p>
      </div>
    }
  </div>
  <div class="mt-2 bg-gray-400 h-96 rounded-md">
    <button (click)="launchRace()">Launch race</button>

    @if (raceInfos(); as race) {
      <div class="flex flex-row justify-around">
        <div class="grow">
          Race status : {{ race.state }}
        </div>
        <div class="grow">
          Race end bet time: {{ race.endBetTime | date:'H:mm:ss' }}
        </div>
        <div class="grow">
          Race Start time: {{ race.startTime | date:'H:mm:ss' }}
        </div>
      </div>
      @if (race.state === RaceState.BetsOpened) {
        <ul>
          @for (robot of race.robots; track robot.name) {
            <li>{{ robot.name }}, {{ robot.stats | json }}</li>
          }
        </ul>
        @if (raceStartTime() > 0) {
          <div class="flex flex-row">
            Race will start in: {{ raceStartTime() }}
          </div>
        }
      } @else if (race.state === RaceState.BetsClosed || race.state === RaceState.InProgress) {
        <ul>
          @for (robot of race.robots; track robot.name) {
            <li class="bot-point"
                [ngStyle]="{'background-color': robot.color, 'margin-left': robot.distanceTraveled + 'px'}"></li>
          }
        </ul>
        @if (race.state === RaceState.BetsClosed) {
          <div class="flex flex-row">
            Race will start soon
          </div>
        }
      }

      @if (race.state === RaceState.Finished) {
        <ul>
          @for (robot of race.robots; track robot.name) {
            <li>{{ robot.name }} - {{ robot.distanceTraveled }} m</li>
          }
        </ul>
      }
    } @else {
      <p>No race yet !</p>
    }

  </div>
</div>
